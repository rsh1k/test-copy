runs:
  using: "composite"
  steps:
    # ... (existing steps: Checkout core repository, Set dotCMS version, Pull and run dotCMS Docker image)

    - name: Pull and run dotCMS Docker image
      shell: bash
      run: |
        docker pull dotcms/dotcms:${{ env.DOTCMS_VERSION }}
        # The docker run command isn't strictly necessary for the scan, 
        # but we'll leave it as it was in your original action.
        docker run -d -p 8082:8082 dotcms/dotcms:${{ env.DOTCMS_VERSION }}

    # --- New Steps for Credential Detector ---

    - name: Setup Go for Credential Detector
      uses: actions/setup-go@v5
      with:
        go-version: '1.22' # Use a recent stable Go version

    - name: Install credential-detector
      shell: bash
      run: |
        go install github.com/ynori7/credential-detector@latest

    - name: Scan Docker Image with Credential Detector
      shell: bash
      run: |
        # Ensure the Go bin path is available
        export PATH="$HOME/go/bin:$PATH"
        
        # Define output file path
        OUTPUT_FILE="core/credential-detector-results-${{ env.DOTCMS_VERSION }}.txt"
        
        echo "Starting credential-detector scan on dotcms/dotcms:${{ env.DOTCMS_VERSION }}"
        
        # Run the scan and save the output
        credential-detector scan-image dotcms/dotcms:${{ env.DOTCMS_VERSION }} > $OUTPUT_FILE
        
        # Display the results
        echo "--- Scan Results ---"
        cat $OUTPUT_FILE
        echo "--------------------"
        
    # --- Optional: Upload the credential detector results as an artifact ---
    - name: Upload Credential Detector Results
      uses: actions/upload-artifact@v4
      with:
        name: credential-detector-results-${{ env.DOTCMS_VERSION }}
        path: core/credential-detector-results-${{ env.DOTCMS_VERSION }}.txt

    # ... (existing steps: Install pipx, Scan Docker Image with Syft, etc.)
